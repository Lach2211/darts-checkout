<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111" />
  <title>Darts Checkout Rechner (PWA)</title>

    <link rel="manifest" href="manifest.json">

  <style>
    /* ===== Reset & Layout auf 100% ===== */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0e0e10;
      color: #eee;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
    .app {
      min-height: 100vh;      /* volle Höhe */
      width: 100vw;           /* volle Breite */
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    .bar {
      display: grid;
      gap: .5rem;
      grid-template-columns: repeat(3, minmax(0,1fr));
      padding: .75rem;
      background: #16161a;
      position: sticky;
      top: 0;
      z-index: 5;
      border-bottom: 1px solid #26262b;
    }
    .mode-btn {
      padding: .65rem .8rem;
      border: 1px solid #333;
      background: #1f1f24;
      color: #ddd;
      border-radius: .6rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    .mode-btn.active { outline: 2px solid #ff5252; outline-offset: 2px; }

    .fav-wrap {
      display: grid;
      gap: .5rem;
      grid-template-columns: repeat(6, minmax(0,1fr));
      padding: .6rem .75rem .4rem;
      background: #121216;
      border-bottom: 1px solid #26262b;
    }
    .fav-btn {
      padding: .5rem .4rem;
      border: 2px solid #2a2a2f;
      background: #18181d;
      color: #eaeaea;
      border-radius: .6rem;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      letter-spacing: .3px;
      user-select: none;
      transition: transform .05s ease;
    }
    .fav-btn:active { transform: scale(0.98); }

    /* Rang-Umrandungen für Lieblings-Doppel (1=grün, 2=rot, 3=weiß) */
    .fav-btn[data-rank="1"] { border-color: #20d64a; box-shadow: 0 0 0 1px #20d64a55 inset; }
    .fav-btn[data-rank="2"] { border-color: #ff5252; box-shadow: 0 0 0 1px #ff525255 inset; }
    .fav-btn[data-rank="3"] { border-color: #ffffff; box-shadow: 0 0 0 1px #ffffff55 inset; }

    .fav-actions {
      display: flex; gap: .5rem; padding: 0 .75rem .75rem; background: #121216; align-items: center; flex-wrap: wrap;
      border-bottom: 1px solid #26262b;
    }
    .small-btn {
      padding: .45rem .65rem;
      border-radius: .5rem;
      border: 1px solid #333;
      background: #1f1f24;
      color: #ddd;
      cursor: pointer;
    }

    /* Score-Grid füllt die ganze Breite, responsive Kacheln */
    .grid {
      --tile-min: 70px; /* Mindestbreite einer Kachel */
      padding: .75rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--tile-min), 1fr));
      gap: .5rem;
      flex: 1;
      overflow: auto; /* bei vielen Scores scrollbar */
    }
    .tile {
  _     display: flex; align-items: center; justify-content: center;
      padding: 1rem .5rem;
      background: #17171b;
      border: 1px solid #2c2c33;
      border-radius: .75rem;
      font-weight: 800;
      font-size: 1.1rem;
      cursor: pointer;
      user-select: none;
    }
    .tile:active { transform: scale(0.985); }

    /* 3-Dart-Minimum (61+) Hervorhebung */
    .tile.min3 {
      border-color: #ff5252;
      background: #1a0f10;
      box-shadow: 0 0 0 2px #ff525233 inset;
    }

    /* Ergebnisbereich */
    .results {
      padding: .75rem;
      border-top: 1px solid #26262b;
      background: #121216;
    }
    .top3 {
      display: grid;
      gap: .5rem;
      grid-template-columns: 1fr;
    }
    .res-card {
      padding: .75rem;
      border: 1px solid #2c2c33;
      background: #18181d;
      border-radius: .75rem;
      line-height: 1.35;
    }
    .res-card.best { outline: 2px solid #20d64a; }
    details.summarybox {
      margin-top: .5rem;
      border: 1px dashed #2c2c33;
      border-radius: .6rem;
      background: #0f0f12;
      padding: .5rem .75rem;
    }
    details summary { cursor: pointer; font-weight: 700; color: #bbb; }
    .muted { color: #9aa; font-size: .9rem; }
  </style>
</head>
<body>
  <div class="app" id="app">
        <div class="bar">
      <button class="mode-btn" data-mode="DO">Double Out</button>
      <button class="mode-btn" data-mode="MO">Master Out</button>
      <button class="mode-btn" data-mode="SO">Straight Out</button>
    </div>

        <div class="fav-wrap" id="favWrap">
          </div>
    <div class="fav-actions">
      <span class="muted">Reihenfolge: 1 = <b style="color:#20d64a">grün</b>, 2 = <b style="color:#ff5252">rot</b>, 3 = <b style="color:#fff">weiß</b></span>
      <button class="small-btn" id="resetFavs">Auswahl zurücksetzen</button>
    </div>

        <div class="grid" id="scoreGrid" aria-live="polite"></div>

        <div class="results" id="results" hidden>
      <div class="top3" id="top3"></div>
      <details class="summarybox" id="moreBox">
        <summary>Alle weiteren Checkouts anzeigen</summary>
        <div id="moreList" style="margin-top:.5rem; display:grid; gap:.5rem;"></div>
      </details>
    </div>
  </div>

  <script>
    /* ===== Zustand ===== */
    const bogeyDO = new Set([169,168,166,165,163,162,159]); // im DO nicht checkbar
    const bogeySISO = new Set([179, 178, 176, 175, 173, 172]); // Mathematisch unmögliche 3-Dart-Scores
    let mode = localStorage.getItem('mode') || 'DO';
    let favorites = JSON.parse(localStorage.getItem('favorites')||'[]'); // z.B. ["D20","D16","D25"]

    /* ===== DOM ===== */
    const btnsMode = [...document.querySelectorAll('.mode-btn')];
    const scoreGrid = document.getElementById('scoreGrid');
    const favWrap = document.getElementById('favWrap');
    const resultsEl = document.getElementById('results');
    const top3El = document.getElementById('top3');
    const moreBox = document.getElementById('moreBox');
    const moreList = document.getElementById('moreList');
s   const resetFavsBtn = document.getElementById('resetFavs');

    /* ===== Lieblings-Doppel Buttons erzeugen ===== */
    const favItems = ["D10","D11","D12","D13","D14","D15","D16","D17","D18","D19","D20","D25"]; // D25 = Bull
    function renderFavButtons() {
      favWrap.innerHTML = '';
      favItems.forEach(d => {
        const b = document.createElement('button');
        b.className = 'fav-btn';
        b.textContent = d;
        // Rank (1..3) oder leer
        const rank = favorites.indexOf(d);
        if (rank !== -1) b.dataset.rank = (rank+1).toString();
        b.addEventListener('click', () => toggleFavorite(d));
        favWrap.appendChild(b);
      });
    }
    function toggleFavorite(dbl) {
      const idx = favorites.indexOf(dbl);
      if (idx >= 0) {
        favorites.splice(idx,1); // entfernen
      } else {
        if (favorites.length < 3) favorites.push(dbl);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderFavButtons();
      // Ergebnisse ggf. neu priorisieren
      if (currentScore != null) showCheckouts(currentScore);
    }
    resetFavsBtn.addEventListener('click', () => {
      favorites = [];
      localStorage.setItem('favorites', '[]');
      renderFavButtons();
      if (currentScore != null) showCheckouts(currentScore);
    });

    /* ===== Modus-Steuerung ===== */
    btnsMode.forEach(b=>{
      b.addEventListener('click', ()=>{
        mode = b.dataset.mode;
        localStorage.setItem('mode', mode);
        updateModeButtons();
        renderScores();
        clearResults();
      });
    });
    function updateModeButtons(){
      btnsMode.forEach(b=> b.classList.toggle('active', b.dataset.mode===mode));
    }

    /* ===== Score-Liste ===== */
    function renderScores(){
      scoreGrid.innerHTML = '';
      const range = (mode==='DO') ? {min:2, max:170} : {min:2, max:180};
      for (let s = range.max; s >= range.min; s--) {
        if (mode==='DO' && bogeyDO.has(s)) continue; // Bogey-Zahlen im DO entfernen
        
        // Mathematisch unmögliche 3-Dart-Scores in MO/SO entfernen
        if (mode!=='DO' && bogeySISO.has(s)) continue; 

        const tile = document.createElement('button');
        tile.className = 'tile';
        if (s >= 61) tile.classList.add('min3'); // 3-Dart-Minimum Hervorhebung
        tile.textContent = s;
        tile.addEventListener('click', ()=> onScoreClick(s));
        scoreGrid.appendChild(tile);
      }
  </script>
</body>
</html>
