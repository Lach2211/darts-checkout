<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111" />
  <title>Darts Checkout Rechner (PWA)</title>

    <link rel="manifest" href="manifest.json">

  <style>
    /* ===== Reset & Layout auf 100% ===== */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0e0e10;
      color: #eee;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
    .app {
      min-height: 100vh;      /* volle Höhe */
      width: 100vw;           /* volle Breite */
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    .bar {
      display: grid;
      gap: .5rem;
      grid-template-columns: repeat(3, minmax(0,1fr));
      padding: .75rem;
      background: #16161a;
      position: sticky;
      top: 0;
      z-index: 5;
      border-bottom: 1px solid #26262b;
    }
    .mode-btn {
      padding: .65rem .8rem;
      border: 1px solid #333;
      background: #1f1f24;
      color: #ddd;
      border-radius: .6rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    .mode-btn.active { outline: 2px solid #ff5252; outline-offset: 2px; }

    /* Score-Grid füllt die ganze Breite, responsive Kacheln */
    .grid {
      --tile-min: 70px; /* Mindestbreite einer Kachel */
      padding: .75rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--tile-min), 1fr));
      gap: .5rem;
      flex: 1;
      overflow: auto; /* bei vielen Scores scrollbar */
    }
    .tile {
      display: flex; align-items: center; justify-content: center;
      padding: 1rem .5rem;
      background: #17171b;
      border: 1px solid #2c2c33;
      border-radius: .75rem;
      font-weight: 800;
      font-size: 1.1rem;
      cursor: pointer;
      user-select: none;
    }
    .tile:active { transform: scale(0.985); }

    /* Finish-Zonen Hervorhebung (NEU) */
    /* 3-Dart (Rot) */
    .tile.min3 {
      border-color: #ff5252;
      background: #1a0f10;
      box-shadow: 0 0 0 2px #ff525233 inset;
    }
    /* 2-Dart (Gelb) */
    .tile.min2 {
      border-color: #ffd54a;
      background: #1a180f;
      box-shadow: 0 0 0 2px #ffd54a33 inset;
    }
    /* 1-Dart (Grün) */
    .tile.min1 {
      border-color: #20d64a;
      background: #0f1a10;
      box-shadow: 0 0 0 2px #20d64a33 inset;
    }

    /* Ergebnisbereich */
    .results {
      padding: .75rem;
      border-top: 1px solid #26262b;
      background: #121216;
    }
    .top3 {
      display: grid;
      gap: .5rem;
      grid-template-columns: 1fr;
    }
    .res-card {
      padding: .75rem;
      border: 1px solid #2c2c33;
      background: #18181d;
      border-radius: .75rem;
      line-height: 1.35;
    }
    .res-card.best { outline: 2px solid #20d64a; }
    details.summarybox {
      margin-top: .5rem;
      border: 1px dashed #2c2c33;
      border-radius: .6rem;
      background: #0f0f12;
      padding: .5rem .75rem;
    }
    details summary { cursor: pointer; font-weight: 700; color: #bbb; }
    .muted { color: #9aa; font-size: .9rem; }
  </style>
</head>
<body>
  <div class="app" id="app">
        <div class="bar">
      <button class="mode-btn" data-mode="DO">Double Out</button>
      <button class="mode-btn" data-mode="MO">Master Out</button>
      <button class="mode-btn" data-mode="SO">Straight Out</button>
    </div>

        <div class="grid" id="scoreGrid" aria-live="polite"></div>

        <div class="results" id="results" hidden>
      <div class="top3" id="top3"></div>
      <details class="summarybox" id="moreBox">
        <summary>Weitere Profi-Wege</summary>
        <div id="moreList" style="margin-top:.5rem; display:grid; gap:.5rem;"></div>
      </details>
    </div>
  </div>

  <script>
    /* ===== Zustand ===== */
    const bogeyDO = new Set([169,168,166,165,163,162,159]);
    const bogeySISO = new Set([179, 178, 176, 175, 173, 172]);
    let mode = localStorage.getItem('mode') || 'DO';
    let currentScore = null;

    /* ===== Profi-Checkout-Tabelle (NEU, statt Rechenlogik) ===== */
    // Basiert auf "Variante 1" deines Screenshots
    const proCheckoutTable = new Map([
      [170, "T20 T20 BULL"],
      [167, "T20 T19 BULL"],
      [164, "T20 T18 BULL"],
      [161, "T20 T17 BULL"],
      [160, "T20 T20 D20"],
      [158, "T20 T20 D19"],
      [157, "T20 T19 D20"],
      [156, "T20 T20 D18"],
      [155, "T20 T19 D19"],
      [154, "T20 T18 D20"],
      [153, "T20 T19 D18"],
      [152, "T20 T20 D16"],
      [151, "T20 T17 D20"],
      [150, "T20 T18 D18"],
      [149, "T20 T19 D16"],
      [148, "T20 T16 D20"],
      [147, "T20 T17 D18"],
      [146, "T20 T18 D16"],
      [145, "T20 T15 D20"],
      [144, "T20 T20 D12"],
      [143, "T20 T17 D16"],
      [142, "T20 T14 D20"],
      [141, "T20 T19 D12"],
      [140, "T20 T16 D16"],
      [139, "T19 T14 D20"],
      [138, "T20 T18 D12"],
      [137, "T20 T19 D10"],
      [136, "T20 T20 D8"],
      [135, "T20 T17 D12"],
      [134, "T20 T14 D16"],
      [133, "T20 T19 D8"],
      [132, "T20 T16 D12"],
      [131, "T20 T13 D16"],
      [130, "T20 T10 D20"],
      [129, "T19 T10 D20"],
      [128, "T18 T14 D16"],
      [127, "T20 T17 D8"],
      [126, "T19 T19 D6"],
      [125, "S25 T20 D20"],
      [124, "T20 T16 D8"],
      [123, "T19 T16 D9"],
      [122, "T18 T20 D4"],
      [121, "T20 T11 D14"],
      [120, "T20 S20 D20"],
      [119, "T19 T12 D13"],
      [118, "T20 S18 D20"],
      [117, "T20 S17 D20"],
      [116, "T20 S16 D20"],
      [115, "T20 S15 D20"],
      [114, "T20 S14 D20"],
      [113, "T20 S13 D20"],
      [112, "T20 S12 D20"],
      [111, "T20 S11 D20"],
      [110, "T20 S10 D20"],
      [109, "T19 S12 D20"],
      [108, "T20 S8 D20"],
      [107, "T19 S10 D20"],
      [106, "T20 S6 D20"],
      [105, "T20 S5 D20"],
      [104, "T18 S10 D20"],
      [103, "T19 S6 D20"],
      [102, "T20 S2 D20"],
      [101, "T20 S1 D20"],
      [100, "T20 D20"],
      [99, "T19 D21"],
      [98, "T20 D19"],
      [97, "T19 D20"],
      [96, "T20 D18"],
      [95, "T19 D19"],
      [94, "T18 D20"],
      [93, "T19 D18"],
      [92, "T20 D16"],
      [91, "T17 D20"],
      [90, "T20 D15"],
      [89, "T19 D16"],
      [88, "T20 D14"],
      [87, "T17 D18"],
      [86, "T18 D16"],
      [85, "T15 D20"],
      [84, "T20 D12"],
      [83, "T17 D16"],
      [82, "T14 D20"],
      [81, "T19 D12"],
      [80, "T20 D10"],
      [79, "T13 D20"],
      [78, "T18 D12"],
      [77, "T19 D10"],
      [76, "T20 D8"],
      [75, "T17 D12"],
      [74, "T14 D16"],
      [73, "T19 D8"],
      [72, "T16 D12"],
      [71, "T13 D16"],
      [70, "T10 D20"],
      [69, "T19 D6"],
      [68, "T20 D4"],
      [67, "T17 D8"],
      [66, "T10 D18"],
      [65, "S25 D20"],
      [64, "T16 D8"],
      [63, "T13 D12"],
      [62, "T10 D16"],
      [61, "T11 D14"],
      [60, "S20 D20"],
      [59, "S19 D20"],
      [58, "S18 D20"],
      [57, "S17 D20"],
      [56, "S16 D20"],
      [55, "S15 D20"],
      [54, "S14 D20"],
      [53, "S13 D20"],
      [52, "S12 D20"],
      [51, "S11 D20"],
      [50, "BULL"],
      [49, "S9 D20"],
      [48, "S16 D16"],
      [47, "S15 D16"],
      [46, "S6 D20"],
      [45, "S13 D16"],
      [44, "S12 D16"],
      [43, "S11 D16"],
      [42, "S10 D16"],
      [41, "S9 D16"],
      [40, "D20"],
      [39, "S7 D16"],
      [38, "D19"],
      [37, "S5 D16"],
      [36, "D18"],
      [35, "S3 D16"],
      [34, "D17"],
      [33, "S1 D16"],
      [32, "D16"],
      [31, "S15 D8"],
      [30, "D15"],
      [29, "S13 D8"],
      [28, "D14"],
      [27, "S11 D8"],
      [26, "D13"],
      [25, "S9 D8"],
      [24, "D12"],
      [23, "S7 D8"],
      [22, "D11"],
      [21, "S5 D8"],
      [20, "D10"],
      [19, "S3 D8"],
      [18, "D9"],
      [17, "S1 D8"],
      [16, "D8"],
      [15, "S7 D4"],
      [14, "D7"],
      [13, "S5 D4"],
      [12, "D6"],
      [11, "S3 D4"],
      [10, "D5"],
      [9, "S1 D4"],
      [8, "D4"],
      [7, "S3 D2"],
      [6, "D3"],
      [5, "S1 D2"],
      [4, "D2"],
      [3, "S1 D1"],
      [2, "D1"]
    ]);
    
    // Alternative Wege (Variante 2 aus Screenshot)
    const proCheckoutTableV2 = new Map([
      [121, "T17 T10 D20"],
      [110, "T20 D25"],
      [100, "S20 BULL"],
      [98, "T18 D22"], // Nur als Beispiel, Logik kann erweitert werden
      [65, "T15 D10"],
      [61, "S25 D18"]
    ]);

    /* ===== DOM ===== */
    const btnsMode = [...document.querySelectorAll('.mode-btn')];
    const scoreGrid = document.getElementById('scoreGrid');
    const resultsEl = document.getElementById('results');
    const top3El = document.getElementById('top3');
    const moreBox = document.getElementById('moreBox');
    const moreList = document.getElementById('moreList');

    /* ===== Modus-Steuerung ===== */
    btnsMode.forEach(b=>{
      b.addEventListener('click', ()=>{
        mode = b.dataset.mode;
        localStorage.setItem('mode', mode);
        updateModeButtons();
        renderScores();
        clearResults();
      });
    });
    function updateModeButtons(){
      btnsMode.forEach(b=> b.classList.toggle('active', b.dataset.mode===mode));
      // MO/SO Logik ist in dieser Profi-Tabelle nicht enthalten,
      // blende Ergebnisse aus, wenn nicht DO
      if (mode !== 'DO') {
        scoreGrid.style.display = 'none';
      } else {
        scoreGrid.style.display = 'grid';
      }
    }

    /* ===== Score-Liste ===== */
    function renderScores(){
      scoreGrid.innerHTML = '';
      const range = (mode==='DO') ? {min:2, max:170} : {min:2, max:180};
      
      // Hinweis für MO/SO
      if (mode !== 'DO') {
        scoreGrid.innerHTML = `<div style="padding: 1rem; color: #9aa;">Profi-Checkout-Tabelle ist nur für Double Out (DO) verfügbar.</div>`;
        return;
      }

      for (let s = range.max; s >= range.min; s--) {
        if (mode==='DO' && bogeyDO.has(s)) continue; 
        if (mode!=='DO' && bogeySISO.has(s)) continue; 

        const tile = document.createElement('button');
        tile.className = 'tile';
        
        // NEUE Zonen-Logik
        if (s > 110) {
          tile.classList.add('min3'); // 3-Dart: 111-170
        } else if (s > 40 && s !== 50) {
          tile.classList.add('min2'); // 2-Dart: 41-49, 51-110
        } else if (s <= 40 || s === 50) {
          tile.classList.add('min1'); // 1-Dart: 2-40, 50
        }
        
        tile.textContent = s;
        tile.addEventListener('click', ()=> onScoreClick(s));
        scoreGrid.appendChild(tile);
      }
    }

    /* ===== Checkout-Logik (NEU: Tabellen-Suche) ===== */
    function findFinishes(score) {
      if (mode !== 'DO') return []; // Nur für DO
      
      const v1 = proCheckoutTable.get(score);
      const v2 = proCheckoutTableV2.get(score);
      
      // Gibt [v1, v2] oder [v1] oder [] zurück, filtert 'undefined' raus
      return [v1, v2].filter(Boolean);
    }

    /* ===== Ergebnisse darstellen (Vereinfacht) ===== */
    function onScoreClick(s) {
      currentScore = s;
      showCheckouts(s);
    }
    function clearResults(){
      resultsEl.hidden = true;
      top3El.innerHTML = '';
      moreList.innerHTML = '';
      moreBox.open = false;
      moreBox.hidden = true;
    }
    function showCheckouts(s){
      const paths = findFinishes(s);
      clearResults();
      
      if (!paths.length) {
        resultsEl.hidden = false;
        top3El.innerHTML = `<div class="res-card">Kein Profi-Checkout für ${s} hinterlegt.</div>`;
        return;
      }
      
      resultsEl.hidden = false;
      const best = paths[0]; // Variante 1 ist der "beste" Weg
      const rest = paths.slice(1); // Alle Alternativen (Variante 2 etc.)

      // Zeige den besten Weg
      top3El.innerHTML = `<div class="res-card best">
           <div><strong>${currentScore}</strong> ➝ ${best}</div>
           <div class="muted">Profi-Weg (Variante 1)</div>
         </div>`;

      // Zeige Alternativen, falls vorhanden
      if (rest.length) {
        moreList.innerHTML = rest.map(p=>`<div class="res-card">${p}</div>`).join('');
        moreBox.hidden = false;
      }
    }

    /* ===== Init ===== */
    function init() {
      // PWA SW optional
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js').catch(()=>{ /* ignorieren */ });
      }
      updateModeButtons();
      renderScores();
      btnsMode.find(b=>b.dataset.mode===mode)?.classList.add('active');
    }
    init();
  </script>
</body>
</html>
